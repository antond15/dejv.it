name: Deploy website on push

on:
  push:
    branches: 
      - main

jobs:

  deploy:
    name: Build and deploy
    runs-on: ubuntu-latest

    steps:
      - name: Get latest code
        uses: actions/checkout@v2.3.2

      - name: Use Node.js v16
        uses: actions/setup-node@v2
        with:
          node-version: 16
          cache: 'yarn'

      - name: Build
        run: |
          yarn install
          yarn build

      - name: Sync files
        uses: SamKirkland/FTP-Deploy-Action@4.2.0
        with:
          server: ${{ secrets.ftp_server }}
          username: ${{ secrets.ftp_username }}
          password: ${{ secrets.ftp_password }}
          local-dir: build/
          server-dir: www/

      - name: ðŸ“¦ Successfully deployed
        uses: Ilshidur/action-discord@0.3.2
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
          DISCORD_USERNAME: GitHub
          DISCORD_AVATAR: https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png
          DISCORD_EMBEDS: '[{"description":"Project **antond15/dejv.it** has been successfully deployed via FTP.","color":4437377}]'
